(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6054:(e,r,t)=>{Promise.resolve().then(t.bind(t,6249))},1767:(e,r,t)=>{"use strict";t.d(r,{$:()=>n,V:()=>a});var s=t(2115);let a={message:"",duration:7e3,action:void 0,severity:"success"},n=s.createContext({DefaultSnackbar:a})},6249:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>eh});var s=t(5155),a=t(2115),n=t(1451);let l=e=>(0,s.jsx)(n.A,{...e});var o=t(2866);let i=e=>(0,s.jsx)(o.A,{...e});var d=t(6805);let c=e=>(0,s.jsx)(d.A,{...e});var A=t(810);let x=e=>(0,s.jsx)(A.A,{...e}),h={src:"/story_sage_frontend/_next/static/media/sage-icon.38eefdc5.jpg",height:1024,width:1024,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/2wBDAQoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAE/9oADAMBAAIQAxAAAACGAt//xAAaEAEAAwADAAAAAAAAAAAAAAABAgQSAAMx/9oACAEBAAE/AO4rQp14GXA5MITJeqvP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAIhEf/aAAgBAgEBPwBXbLT/xAAaEQACAgMAAAAAAAAAAAAAAAABEQAhAgNB/9oACAEDAQE/AMdYZVdpT//Z",blurWidth:8,blurHeight:8},u=e=>{let{pageName:r}=e;return(0,s.jsx)(l,{position:"static",children:(0,s.jsx)(i,{maxWidth:"xl",children:(0,s.jsxs)(c,{disableGutters:!0,children:[(0,s.jsx)("img",{src:h.src,alt:"Story Sage",style:{height:50,width:50,borderRadius:25,marginRight:10}}),(0,s.jsx)(x,{variant:"h6",children:r})]})})})};var p=t(8998);let g=e=>(0,s.jsx)(p.A,{...e});var b=t(89),m=t.n(b),j=t(530),k=t.n(j),y=t(1482);let v=e=>(0,s.jsx)(y.A,{...e});var f=t(5617);let C=e=>(0,s.jsx)(f.Ay,{...e});var w=t(2111);let S=e=>(0,s.jsx)(w.A,{...e});var I=t(507);let B=e=>(0,s.jsx)(I.A,{...e});var E=t(5480);let D=e=>(0,s.jsx)(E.A,{...e});var T=t(152);let Q=e=>(0,s.jsx)(T.A,{...e});var R=t(2282);let F=e=>(0,s.jsx)(R.A,{...e});var N=t(6854),_=t(5761),O=t(5565);let U=e=>{let r=(0,_.A)(),t=e.size||40;return(0,s.jsxs)(p.A,{sx:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)(O.default,{src:h,alt:"Sage Icon",style:{height:t,width:t,borderRadius:t/2}}),(0,s.jsx)(N.A,{size:t+5,sx:{color:r.palette.primary.main,position:"absolute"}})]})},G=e=>{let{condition:r,wrapper:t,children:s}=e;return r?t(s):s};var M=t(6682),P=t(5470),W=t(4375),Y=t(4058),q=t(894);let H=e=>(0,s.jsx)(q.A,{...e});var L=t(6331);let X=e=>(0,s.jsx)(L.A,{...e});var z=t(2549),K=t.n(z),V=t(1767);let Z=e=>{let{entry:r}=e,t=(0,_.A)(),{setSnackbar:n}=(0,a.useContext)(V.$),l=async e=>{await K()(r.requestId,e)?n({message:"Feedback Received",severity:"success"}):n({message:"There was an Error Receiving Your Feedback",severity:"error"})};return(0,s.jsxs)(g,{sx:{width:"80%",alignSelf:"user"===r.askedBy?"flex-end":"flex-start",backgroundColor:"user"===r.askedBy?t.palette.primary.main:t.palette.background.default,color:"user"===r.askedBy?t.palette.primary.contrastText:t.palette.text.primary,borderRadius:"user"===r.askedBy?"16px 16px 0 16px":"16px 16px 16px 0",borderWidth:"bot"===r.askedBy?1:0,borderStyle:"bot"===r.askedBy?"solid":"none",borderColor:"bot"===r.askedBy?t.palette.primary.main:"none",padding:2,marginBottom:1},children:[(0,s.jsx)(M.$,{children:r.text,components:{p:e=>{let{children:r}=e;return(0,s.jsx)(x,{children:r})},ul:e=>{let{children:r}=e;return(0,s.jsx)("ul",{style:{marginTop:0,marginBottom:0,paddingInlineStart:"1em"},children:r})}}}),"bot"===r.askedBy&&r.requestId&&(0,s.jsxs)(g,{sx:{display:"flex",justifyContent:"flex-end",marginTop:1},children:[(0,s.jsx)(X,{title:"Included Spoilers",children:(0,s.jsx)(H,{"aria-label":"Included Spoilers",color:"error",onClick:()=>l("spoiler"),children:(0,s.jsx)(Y.A,{})})}),(0,s.jsx)(X,{title:"Not Helpful",children:(0,s.jsx)(H,{"aria-label":"Not Helpful",color:"error",onClick:()=>l("negative"),children:(0,s.jsx)(W.A,{})})}),(0,s.jsx)(X,{title:"Helpful",children:(0,s.jsx)(H,{"aria-label":"Helpful",color:"success",onClick:()=>l("positive"),children:(0,s.jsx)(P.A,{})})})]})]})},J=e=>{let{book:r,chapter:t}=e,a=(0,_.A)();return(0,s.jsxs)(g,{sx:{display:"flex",alignItems:"center",marginY:2},children:[(0,s.jsx)(g,{sx:{flexGrow:1,borderBottom:"1px solid",borderColor:a.palette.divider}}),(0,s.jsx)(x,{sx:{marginX:2,whiteSpace:"nowrap"},children:"Book ".concat(r,", Chapter ").concat(t)}),(0,s.jsx)(g,{sx:{flexGrow:1,borderBottom:"1px solid",borderColor:a.palette.divider}})]})};var $=t(424);let ee=e=>(0,s.jsx)($.A,{...e});var er=t(450),et=t(5295);let es=e=>{let{series:r,selectedSeries:t,selectedBook:n,selectedChapter:l,currentQuestion:o,conversation:i,conversationLoading:d,handleSeriesChange:c,handleBookChange:A,handleChapterChange:h,handleAskQuestion:u,setCurrentQuestion:p,conversationEndRef:b,handleOpenDialog:m}=e,j=(0,_.A)(),k=(0,et.A)(j.breakpoints.up("xl")),y=(0,et.A)(j.breakpoints.up("lg")),f=(0,et.A)(j.breakpoints.up("md")),w=(0,et.A)(j.breakpoints.up("sm")),I=t?r.find(e=>e.seriesId===t).books:[];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(g,{sx:{display:"flex",flexDirection:k||y||f?"row":"column",gap:2},children:[(0,s.jsxs)(S,{fullWidth:w,children:[(0,s.jsx)(B,{id:"series-select-label",children:"Select a Series"}),(0,s.jsx)(v,{labelId:"series-select-label",id:"series-select",label:"Select a Series",value:t||"",onChange:c,disabled:0===r.length||d,children:r.map(e=>(0,s.jsx)(D,{value:e.seriesId,children:e.seriesName},e.seriesId))})]}),(0,s.jsxs)(S,{fullWidth:w,children:[(0,s.jsx)(B,{id:"book-select-label",children:"Select Current Book"}),(0,s.jsx)(v,{labelId:"book-select-label",id:"book-select",label:"Select Current Book",value:n||"",onChange:A,disabled:!t||d,children:I.map(e=>(0,s.jsxs)(D,{value:e.numberInSeries,children:[e.title," (",e.numberInSeries,")"]},e.numberInSeries))})]})]}),t&&n?(0,s.jsxs)(g,{sx:{marginTop:2},children:[(0,s.jsxs)(x,{children:["Chapters Read: ",l||1]}),(0,s.jsx)(C,{value:l||1,onChange:h,min:1,max:n?I.find(e=>e.numberInSeries===n).numberOfChapters:1,disabled:!n||d,valueLabelDisplay:"auto"})]}):(0,s.jsx)(g,{sx:{marginTop:2,marginBottom:2},children:(0,s.jsx)(x,{children:"Please select a series and book."})}),(0,s.jsx)(G,{condition:i.length>0||d,wrapper:e=>(0,s.jsxs)(g,{sx:{borderRadius:3,borderColor:j.palette.primary.main,borderWidth:1,borderStyle:"solid",position:"relative"},children:[(0,s.jsxs)(g,{sx:{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:2,display:"flex",flexDirection:"column",maxHeight:{xs:"50vh",sm:"55vh",md:"60vh",lg:"65vh",xl:"70vh"},overflowY:"auto"},children:[i.map((e,r)=>{let t=i[r-1],n=t&&(t.book!==e.book||t.chapter!==e.chapter);return(0,s.jsxs)(a.Fragment,{children:[(0===r||n)&&(0,s.jsx)(J,{book:e.book,chapter:e.chapter}),(0,s.jsx)(Z,{entry:e})]},r)}),d&&(0,s.jsx)(U,{}),(0,s.jsx)("div",{ref:b})]}),e,i.length>=1&&(0,s.jsx)(ee,{color:"secondary",sx:{position:"absolute",bottom:88,right:16},onClick:m,children:(0,s.jsx)(er.A,{})})]}),children:(0,s.jsxs)(g,{sx:{borderTopWidth:1,borderTopColor:j.palette.primary.main,borderTopStyle:"solid",paddingLeft:i.length>0?2:0,paddingRight:i.length>0?2:0,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,s.jsx)(Q,{label:"Ask a question",fullWidth:!0,variant:"outlined",value:o||"",onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"===e.key&&u()},sx:{marginTop:1,marginBottom:1,marginRight:1},disabled:0===r.length||!t||!n||!l||d}),(0,s.jsx)(F,{variant:"contained",color:"primary",sx:{marginTop:1,marginBottom:1},onClick:u,disabled:0===r.length||!t||!n||!l||!o||d,children:"Ask"})]})})]})};function ea(e,r){localStorage.setItem("conversationHistory_".concat(e),JSON.stringify(r))}let en=e=>{let{children:r}=e;return(0,s.jsx)(g,{sx:{paddingLeft:{xs:1,sm:2,md:3,lg:4,xl:5},paddingRight:{xs:1,sm:2,md:3,lg:4,xl:5},paddingTop:2,paddingBottom:2,maxWidth:{xs:"100%",sm:"100%",md:"100%",lg:"80%",xl:"80%"},margin:"0 auto"},children:r})};var el=t(8416);let eo=e=>(0,s.jsx)(el.A,{...e});var ei=t(6417),ed=t(7753),ec=t(5131),eA=t(6214);function ex(){let[e,r]=(0,a.useState)([]),[t,n]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),[i,d]=(0,a.useState)(null),[c,A]=(0,a.useState)(""),[h,p]=(0,a.useState)([]),[b,j]=(0,a.useState)(!1),y=(0,a.useRef)(null),[v,f]=(0,a.useState)(!1),C=async()=>{if(!c)return;j(!0);let e=[...h,{text:c,askedBy:"user",book:l,chapter:i}];p(e),A(""),ea(t,e);let r=h.filter(e=>e.book===l&&e.chapter===i).map(e=>"user"===e.askedBy?"question: ".concat(e.text):"answer: ".concat(e.text)),s=r.length>0?"QUESTION: ".concat(c,"\n\nQUESTION HISTORY FOR CONTEXT: ").concat(r.join("\n")):c;try{var a;let r=await k()(s,l,i,t),n=[...e,{text:r.result,askedBy:"bot",book:l,chapter:i,requestId:r.request_id,context:r.context}];p(n),ea(t,n),null===(a=y.current)||void 0===a||a.scrollIntoView({behavior:"smooth"})}catch(e){console.error("Error getting answer:",e)}finally{j(!1)}},w=()=>{f(!1)};return(0,a.useEffect)(()=>{(async()=>{r(await m()())})()},[]),(0,a.useEffect)(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[h]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{pageName:"Story Sage"}),(0,s.jsxs)(en,{children:[(0,s.jsx)(g,{sx:{paddingBottom:2},children:(0,s.jsx)(x,{children:"Welcome to Story Sage. You can choose a series then ask questions about the books and chapters that you've read so far."})}),(0,s.jsx)(es,{series:e,selectedSeries:t,selectedBook:l,selectedChapter:i,currentQuestion:c,conversation:h,conversationLoading:b,handleSeriesChange:e=>{let r=e.target.value;n(r);let t=function(e){let r=localStorage.getItem("conversationHistory_".concat(e));return r?JSON.parse(r):[]}(r);if(p(t),t.length>0){let e=t[t.length-1];o(e.book||null),d(e.chapter||null)}else o(null),d(null)},handleBookChange:e=>{o(e.target.value),d(null)},handleChapterChange:(e,r)=>{d(r)},handleAskQuestion:C,setCurrentQuestion:A,conversationEndRef:y,handleOpenDialog:()=>{f(!0)}})]}),(0,s.jsxs)(eo,{open:v,onClose:w,children:[(0,s.jsx)(ei.A,{children:"Delete Conversation"}),(0,s.jsx)(ed.A,{children:(0,s.jsx)(ec.A,{children:"This will restart your conversation on this book series. Deleting the conversation can't be undone."})}),(0,s.jsxs)(eA.A,{children:[(0,s.jsx)(F,{onClick:w,color:"primary",children:"Cancel"}),(0,s.jsx)(F,{onClick:()=>{p([]),ea(t,[]),w()},color:"primary",children:"Confirm Delete"})]})]})]})}function eh(){let[e,r]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{r(!0)},[]),e)?(0,s.jsx)(ex,{}):null}},530:(e,r,t)=>{"use strict";let s=t(9542);async function a(e,r,t,a){try{return(await s.post("https://rapid-terribly-shrew.ngrok-free.app/invoke",{question:e,book_number:r,chapter_number:t,series_id:a},{headers:{"ngrok-skip-browser-warning":"skip"},crossDomain:!0})).data}catch(e){throw console.error("Error fetching answer:",e),e}}e.exports=a},89:(e,r,t)=>{"use strict";let s=t(9542);async function a(){try{let e=(await s.get("https://rapid-terribly-shrew.ngrok-free.app/invoke",{headers:{"ngrok-skip-browser-warning":"skip"},crossDomain:!0})).data;return(function e(r){return Array.isArray(r)?r.map(r=>e(r)):null!==r&&r.constructor===Object?Object.keys(r).reduce((t,s)=>(t[s.replace(/_([a-z])/g,(e,r)=>r.toUpperCase())]=e(r[s]),t),{}):r})(e).sort((e,r)=>e.seriesName.localeCompare(r.seriesName))}catch(e){throw console.error("Error fetching series data:",e),e}}e.exports=a},2549:(e,r,t)=>{"use strict";let s=t(9542);async function a(e,r){try{let t=await s.post("https://rapid-terribly-shrew.ngrok-free.app/feedback",{request_id:e,type:r,feedback:""},{headers:{"ngrok-skip-browser-warning":"skip"},crossDomain:!0});return 200===t.status}catch(e){return console.error("Failed to post feedback:",e),!1}}e.exports=a}},e=>{var r=r=>e(e.s=r);e.O(0,[795,108,441,517,358],()=>r(6054)),_N_E=e.O()}]);