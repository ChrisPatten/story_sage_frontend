(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{6054:(e,r,t)=>{Promise.resolve().then(t.bind(t,6249))},1767:(e,r,t)=>{"use strict";t.d(r,{$:()=>l,V:()=>a});var s=t(2115);let a={message:"",duration:7e3,action:void 0,severity:"success"},l=s.createContext({DefaultSnackbar:a})},6249:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>eh});var s=t(5155),a=t(2115),l=t(1451);let n=e=>(0,s.jsx)(l.A,{...e});var i=t(2866);let o=e=>(0,s.jsx)(i.A,{...e});var d=t(6805);let c=e=>(0,s.jsx)(d.A,{...e});var A=t(810);let x=e=>(0,s.jsx)(A.A,{...e}),h={src:"/story_sage_frontend/_next/static/media/sage-icon.38eefdc5.jpg",height:1024,width:1024,blurDataURL:"data:image/jpeg;base64,/9j/2wBDAAoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/2wBDAQoKCgoKCgsMDAsPEA4QDxYUExMUFiIYGhgaGCIzICUgICUgMy03LCksNy1RQDg4QFFeT0pPXnFlZXGPiI+7u/v/wgARCAAIAAgDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAE/9oADAMBAAIQAxAAAACGAt//xAAaEAEAAwADAAAAAAAAAAAAAAABAgQSAAMx/9oACAEBAAE/AO4rQp14GXA5MITJeqvP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAIhEf/aAAgBAgEBPwBXbLT/xAAaEQACAgMAAAAAAAAAAAAAAAABEQAhAgNB/9oACAEDAQE/AMdYZVdpT//Z",blurWidth:8,blurHeight:8},u=e=>{let{pageName:r}=e;return(0,s.jsx)(n,{position:"static",children:(0,s.jsx)(o,{maxWidth:"xl",children:(0,s.jsxs)(c,{disableGutters:!0,children:[(0,s.jsx)("img",{src:h.src,alt:"Story Sage",style:{height:50,width:50,borderRadius:25,marginRight:10}}),(0,s.jsx)(x,{variant:"h6",children:r})]})})})};var p=t(8998);let g=e=>(0,s.jsx)(p.A,{...e});var b=t(89),j=t.n(b),m=t(530),v=t.n(m),y=t(1482);let k=e=>(0,s.jsx)(y.A,{...e});var f=t(5617);let C=e=>(0,s.jsx)(f.Ay,{...e});var w=t(2111);let S=e=>(0,s.jsx)(w.A,{...e});var B=t(507);let I=e=>(0,s.jsx)(B.A,{...e});var E=t(5480);let D=e=>(0,s.jsx)(E.A,{...e});var Q=t(152);let R=e=>(0,s.jsx)(Q.A,{...e});var T=t(2282);let _=e=>(0,s.jsx)(T.A,{...e});var F=t(6854),N=t(5761),G=t(5565);let M=e=>{let r=(0,N.A)(),t=e.size||40;return(0,s.jsxs)(p.A,{sx:{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center"},children:[(0,s.jsx)(G.default,{src:h,alt:"Sage Icon",style:{height:t,width:t,borderRadius:t/2}}),(0,s.jsx)(F.A,{size:t+5,sx:{color:r.palette.primary.main,position:"absolute"}})]})},U=e=>{let{condition:r,wrapper:t,children:s}=e;return r?t(s):s};var P=t(6682),L=t(5470),O=t(4375),W=t(4058),Y=t(894);let q=e=>(0,s.jsx)(Y.A,{...e});var H=t(6331);let X=e=>(0,s.jsx)(H.A,{...e});var z=t(2549),K=t.n(z),V=t(1767);let Z=e=>{let{entry:r}=e,t=(0,N.A)(),{setSnackbar:l}=(0,a.useContext)(V.$),n=async e=>{await K()(r.requestId,e)?l({message:"Feedback Received",severity:"success"}):l({message:"There was an Error Receiving Your Feedback",severity:"error"})};return(0,s.jsxs)(g,{sx:{width:"80%",alignSelf:"user"===r.askedBy?"flex-end":"flex-start",backgroundColor:"user"===r.askedBy?t.palette.primary.main:t.palette.background.default,color:"user"===r.askedBy?t.palette.primary.contrastText:t.palette.text.primary,borderRadius:"user"===r.askedBy?"16px 16px 0 16px":"16px 16px 16px 0",borderWidth:"bot"===r.askedBy?1:0,borderStyle:"bot"===r.askedBy?"solid":"none",borderColor:"bot"===r.askedBy?t.palette.primary.main:"none",padding:2,marginBottom:1},children:[(0,s.jsx)(P.$,{children:r.text,components:{p:e=>{let{children:r}=e;return(0,s.jsx)(x,{children:r})},ul:e=>{let{children:r}=e;return(0,s.jsx)("ul",{style:{marginTop:0,marginBottom:0,paddingInlineStart:"1em"},children:r})}}}),"bot"===r.askedBy&&r.requestId&&(0,s.jsxs)(g,{sx:{display:"flex",justifyContent:"flex-end",marginTop:1},children:[(0,s.jsx)(X,{title:"Included Spoilers",children:(0,s.jsx)(q,{"aria-label":"Included Spoilers",color:"error",onClick:()=>n("spoiler"),children:(0,s.jsx)(W.A,{})})}),(0,s.jsx)(X,{title:"Not Helpful",children:(0,s.jsx)(q,{"aria-label":"Not Helpful",color:"error",onClick:()=>n("negative"),children:(0,s.jsx)(O.A,{})})}),(0,s.jsx)(X,{title:"Helpful",children:(0,s.jsx)(q,{"aria-label":"Helpful",color:"success",onClick:()=>n("positive"),children:(0,s.jsx)(L.A,{})})})]})]})},J=e=>{let{book:r,chapter:t}=e,a=(0,N.A)();return(0,s.jsxs)(g,{sx:{display:"flex",alignItems:"center",marginY:2},children:[(0,s.jsx)(g,{sx:{flexGrow:1,borderBottom:"1px solid",borderColor:a.palette.divider}}),(0,s.jsx)(x,{sx:{marginX:2,whiteSpace:"nowrap"},children:"Book ".concat(r,", Chapter ").concat(t)}),(0,s.jsx)(g,{sx:{flexGrow:1,borderBottom:"1px solid",borderColor:a.palette.divider}})]})};var $=t(424);let ee=e=>(0,s.jsx)($.A,{...e});var er=t(450),et=t(5295);let es=e=>{let{series:r,selectedSeries:t,selectedBook:l,selectedChapter:n,currentQuestion:i,conversation:o,conversationLoading:d,handleSeriesChange:c,handleBookChange:A,handleChapterChange:h,handleAskQuestion:u,setCurrentQuestion:p,conversationEndRef:b,handleOpenDialog:j}=e,m=(0,N.A)(),v=(0,et.A)(m.breakpoints.up("xl")),y=(0,et.A)(m.breakpoints.up("lg")),f=(0,et.A)(m.breakpoints.up("md")),w=(0,et.A)(m.breakpoints.up("sm")),B=t?r.find(e=>e.seriesId===t).books:[];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(g,{sx:{display:"flex",flexDirection:v||y||f?"row":"column",gap:2},children:[(0,s.jsxs)(S,{fullWidth:w,children:[(0,s.jsx)(I,{id:"series-select-label",children:"Select a Series"}),(0,s.jsx)(k,{labelId:"series-select-label",id:"series-select",label:"Select a Series",value:t||"",onChange:c,disabled:0===r.length||d,children:r.map(e=>(0,s.jsx)(D,{value:e.seriesId,children:e.seriesName},e.seriesId))})]}),(0,s.jsxs)(S,{fullWidth:w,children:[(0,s.jsx)(I,{id:"book-select-label",children:"Select Current Book"}),(0,s.jsx)(k,{labelId:"book-select-label",id:"book-select",label:"Select Current Book",value:l||"",onChange:A,disabled:!t||d,children:B.map(e=>(0,s.jsxs)(D,{value:e.numberInSeries,children:[e.title," (",e.numberInSeries,")"]},e.numberInSeries))})]})]}),(0,s.jsxs)(g,{sx:{marginTop:2},children:[(0,s.jsx)(x,{children:"Chapters Read"}),(0,s.jsx)(C,{value:n||1,onChange:h,min:1,max:l?B.find(e=>e.numberInSeries===l).numberOfChapters:1,disabled:!l||d,valueLabelDisplay:"auto"})]}),(0,s.jsx)(U,{condition:o.length>0||d,wrapper:e=>(0,s.jsxs)(g,{sx:{borderRadius:3,borderColor:m.palette.primary.main,borderWidth:1,borderStyle:"solid",position:"relative"},children:[(0,s.jsxs)(g,{sx:{paddingTop:2,paddingBottom:2,paddingLeft:2,paddingRight:2,display:"flex",flexDirection:"column",maxHeight:{xs:"50vh",sm:"55vh",md:"60vh",lg:"65vh",xl:"70vh"},overflowY:"auto"},children:[o.map((e,r)=>{let t=o[r-1],l=t&&(t.book!==e.book||t.chapter!==e.chapter);return(0,s.jsxs)(a.Fragment,{children:[(0===r||l)&&(0,s.jsx)(J,{book:e.book,chapter:e.chapter}),(0,s.jsx)(Z,{entry:e})]},r)}),d&&(0,s.jsx)(M,{}),(0,s.jsx)("div",{ref:b})]}),e,o.length>=1&&(0,s.jsx)(ee,{color:"secondary",sx:{position:"absolute",bottom:88,right:16},onClick:j,children:(0,s.jsx)(er.A,{})})]}),children:(0,s.jsxs)(g,{sx:{borderTopWidth:1,borderTopColor:m.palette.primary.main,borderTopStyle:"solid",paddingLeft:o.length>0?2:0,paddingRight:o.length>0?2:0,display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[(0,s.jsx)(R,{label:"Ask a question",fullWidth:!0,variant:"outlined",value:i||"",onChange:e=>p(e.target.value),onKeyPress:e=>{"Enter"===e.key&&u()},sx:{marginTop:1,marginBottom:1,marginRight:1},disabled:0===r.length||!t||!l||!n||d}),(0,s.jsx)(_,{variant:"contained",color:"primary",sx:{marginTop:1,marginBottom:1},onClick:u,disabled:0===r.length||!t||!l||!n||!i||d,children:"Ask"})]})})]})};function ea(e,r){localStorage.setItem("conversationHistory_".concat(e),JSON.stringify(r))}let el=e=>{let{children:r}=e;return(0,s.jsx)(g,{sx:{paddingLeft:{xs:1,sm:2,md:3,lg:4,xl:5},paddingRight:{xs:1,sm:2,md:3,lg:4,xl:5},paddingTop:2,paddingBottom:2},children:r})};var en=t(8416);let ei=e=>(0,s.jsx)(en.A,{...e});var eo=t(6417),ed=t(7753),ec=t(5131),eA=t(6214);function ex(){let[e,r]=(0,a.useState)([]),[t,l]=(0,a.useState)(null),[n,i]=(0,a.useState)(null),[o,d]=(0,a.useState)(null),[c,A]=(0,a.useState)(""),[h,p]=(0,a.useState)([]),[b,m]=(0,a.useState)(!1),y=(0,a.useRef)(null),[k,f]=(0,a.useState)(!1),C=async()=>{if(!c)return;m(!0);let e=[...h,{text:c,askedBy:"user",book:n,chapter:o}];p(e),A(""),ea(t,e);try{var r;let s=await v()(c,n,o,t),a=[...e,{text:s.result,askedBy:"bot",book:n,chapter:o,requestId:s.request_id,context:s.context}];p(a),ea(t,a),null===(r=y.current)||void 0===r||r.scrollIntoView({behavior:"smooth"})}catch(e){console.error("Error getting answer:",e)}finally{m(!1)}},w=()=>{f(!1)};return(0,a.useEffect)(()=>{(async()=>{r(await j()())})()},[]),(0,a.useEffect)(()=>{var e;null===(e=y.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[h]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u,{pageName:"Story Sage"}),(0,s.jsxs)(el,{children:[(0,s.jsx)(g,{sx:{paddingBottom:2},children:(0,s.jsx)(x,{children:"Welcome to Story Sage. You can choose a series then ask questions about the books and chapters that you've read so far."})}),(0,s.jsx)(es,{series:e,selectedSeries:t,selectedBook:n,selectedChapter:o,currentQuestion:c,conversation:h,conversationLoading:b,handleSeriesChange:e=>{let r=e.target.value;l(r);let t=function(e){let r=localStorage.getItem("conversationHistory_".concat(e));return r?JSON.parse(r):[]}(r);if(p(t),t.length>0){let e=t[t.length-1];i(e.book||null),d(e.chapter||null)}else i(null),d(null)},handleBookChange:e=>{i(e.target.value),d(null)},handleChapterChange:(e,r)=>{d(r)},handleAskQuestion:C,setCurrentQuestion:A,conversationEndRef:y,handleOpenDialog:()=>{f(!0)}})]}),(0,s.jsxs)(ei,{open:k,onClose:w,children:[(0,s.jsx)(eo.A,{children:"Delete Conversation"}),(0,s.jsx)(ed.A,{children:(0,s.jsx)(ec.A,{children:"This will restart your conversation on this book series. Deleting the conversation can't be undone."})}),(0,s.jsxs)(eA.A,{children:[(0,s.jsx)(_,{onClick:w,color:"primary",children:"Cancel"}),(0,s.jsx)(_,{onClick:()=>{p([]),ea(t,[]),w()},color:"primary",children:"Confirm Delete"})]})]})]})}function eh(){let[e,r]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{r(!0)},[]),e)?(0,s.jsx)(ex,{}):null}},530:(e,r,t)=>{"use strict";let s=t(9542);async function a(e,r,t,a){try{return(await s.post("https://rapid-terribly-shrew.ngrok-free.app/invoke",{question:e,book_number:r,chapter_number:t,series_id:a},{headers:{"ngrok-skip-browser-warning":"skip"},crossDomain:!0})).data}catch(e){throw console.error("Error fetching answer:",e),e}}e.exports=a},89:(e,r,t)=>{"use strict";let s=t(9542);async function a(){try{let e=(await s.get("https://rapid-terribly-shrew.ngrok-free.app/invoke",{headers:{"ngrok-skip-browser-warning":"skip"},crossDomain:!0})).data;return(function e(r){return Array.isArray(r)?r.map(r=>e(r)):null!==r&&r.constructor===Object?Object.keys(r).reduce((t,s)=>(t[s.replace(/_([a-z])/g,(e,r)=>r.toUpperCase())]=e(r[s]),t),{}):r})(e).sort((e,r)=>e.seriesName.localeCompare(r.seriesName))}catch(e){throw console.error("Error fetching series data:",e),e}}e.exports=a},2549:(e,r,t)=>{"use strict";let s=t(9542);async function a(e,r){try{let t=await s.post("https://rapid-terribly-shrew.ngrok-free.app/feedback",{request_id:e,type:r,feedback:""},{headers:{"ngrok-skip-browser-warning":"skip"},crossDomain:!0});return 200===t.status}catch(e){return console.error("Failed to post feedback:",e),!1}}e.exports=a}},e=>{var r=r=>e(e.s=r);e.O(0,[795,108,441,517,358],()=>r(6054)),_N_E=e.O()}]);